import React, { Component } from "react";
import ReactEcharts from "echarts-for-react";
import { jsNum } from '@utils/constants'

class TableInfo extends Component {
    constructor(props) {
        super(props);
        this.state = {
        }
        this.option1 = {
            title: {
                text: "1.64%",
                textStyle: {
                    color: '#57AEFF',
                    fontWeight: 300,
                    fontSize: jsNum(14),
                },
                x: 'center',
                y: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a}{b}: {c} ({d}%)"
            },
            legend: {
                show: false
            },
            color: ['#57AEFF', '#F0F2F5'],
            series: [
                {
                    name: '视力占比',
                    type: 'pie',
                    radius: ['50%', '70%'],
                    avoidLabelOverlap: false,
                    label: {
                        normal: {
                            show: false
                        },
                    },
                    labelLine: {
                        normal: {
                            show: true
                        }
                    },
                }
            ]
        };
        this.option2 = {
            title: {
                text: "17.85%",
                textStyle: {
                    color: '#3DCDCD',
                    fontWeight: 300,
                    fontSize: jsNum(14),
                },
                x: 'center',
                y: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b}: {c} ({d}%)"
            },
            legend: {
                show: false
            },
            color: ['#3DCDCD', '#F0F2F5'],
            series: [
                {
                    name: '视力占比',
                    type: 'pie',
                    radius: ['50%', '70%'],
                    avoidLabelOverlap: false,
                    label: {
                        normal: {
                            show: false
                        },
                    },
                    labelLine: {
                        normal: {
                            show: true
                        }
                    },
                }
            ]
        };
        this.option3 = {
            title: {
                text: "43.88%",
                textStyle: {
                    color: '#FBD955',
                    fontWeight: 300,
                    fontSize: jsNum(14),
                },
                x: 'center',
                y: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b}: {c} ({d}%)"
            },
            legend: {
                show: false
            },
            color: ['#FBD955', '#F0F2F5'],
            series: [
                {
                    name: '视力占比',
                    type: 'pie',
                    radius: ['50%', '70%'],
                    avoidLabelOverlap: false,
                    label: {
                        normal: {
                            show: false
                        },
                    },
                    labelLine: {
                        normal: {
                            show: true
                        }
                    },
                }
            ]
        };
    }

    componentDidMount() {
        this.setEchartsData(this.props)
    }

    componentDidUpdate(props) {
        this.setEchartsData(props)
    }

    setEchartsData(props) {
        const { tableData, visionUnusual, visionNormal, visionNoTest } = props;
        let myChart1 = this.echarts1.getEchartsInstance();
        let myChart2 = this.echarts2.getEchartsInstance();
        let myChart3 = this.echarts3.getEchartsInstance();
        myChart1.setOption({
            series: [{
                data: [visionNoTest.length, tableData.length]
            }]
        });
        myChart2.setOption({
            series: [{
                data: [visionNormal.length, tableData.length]
            }]
        });
        myChart3.setOption({
            series: [{
                data: [visionUnusual.length, tableData.length]
            }]
        });
    }


    render() {
        const { tableData, visionUnusual, visionNormal, visionNoTest } = this.props;
        return (
            <div className="table-info">
                <div className="item">
                    <div className="attr">全校人数(人)</div>
                    <div className="value">{tableData.length || 0}</div>
                </div>
                <div className="item">
                    <div className="left">
                        <div className="attr">未测(人)</div>
                        <div className="value">{visionNoTest.length || 0}</div>
                    </div>
                    <div className="right">
                        <ReactEcharts
                            option={this.option1}
                            ref={e => {
                                this.echarts1 = e;
                            }}
                        />
                    </div>
                </div>
                <div className="item">
                    <div className="left">
                        <div className="attr">屈光正常(人)</div>
                        <div className="value">{visionNormal.length || 0}</div>
                    </div>
                    <div className="right">
                        <ReactEcharts
                            option={this.option2}
                            ref={e => {
                                this.echarts2 = e;
                            }}
                        />
                    </div>
                </div>
                <div className="item">
                    <div className="left">
                        <div className="attr">屈光不正(人)</div>
                        <div className="value">{visionUnusual.length || 0}</div>
                    </div>
                    <div className="right">
                        <ReactEcharts
                            option={this.option3}
                            ref={e => {
                                this.echarts3 = e;
                            }}
                        />
                    </div>
                </div>
            </div>
        );
    }
}

export default TableInfo;
